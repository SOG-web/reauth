---
title: Session Plugin
description: Basic session management with lifecycle operations and cleanup.
---

## Overview

The `session` plugin provides **basic session management** capabilities for ReAuth applications. It offers essential features for managing user sessions, including listing active sessions, logging out, and basic cleanup operations.

Key features:

- **Session Information**: Get details about the current session
- **Session Listing**: List all active sessions for a user
- **Session Logout**: Logout from current session
- **Logout All Sessions**: Terminate all sessions for a user
- **Basic Cleanup**: Clean up expired sessions (placeholder implementation)
- **Profile Integration**: Session information in user profiles

<Callout title="Basic Session Management" type="info">
  The session plugin provides fundamental session management features. For
  advanced features like device tracking, geolocation, or session rotation,
  you'll need to implement custom logic or use additional plugins.
</Callout>

## Installation & Setup

```npm
npm i @re-auth/reauth
```

### Basic Configuration

```ts
import createReAuthEngine, {
  reauthDb,
  reauthDbVersions,
} from '@re-auth/reauth';
import { kyselyAdapter } from 'fumadb/adapters/kysely';
import sessionPlugin, { sessionSchema } from '@re-auth/reauth/plugins/session';
import emailPasswordPlugin, {
  emailPasswordSchema,
} from '@re-auth/reauth/plugins/email-password';

// Setup database schema and client
const { schema: v1 } = reauthDb('1.0.1', [emailPasswordSchema, sessionSchema]);
const factory = reauthDbVersions([v1]);
const client = factory.client(
  kyselyAdapter({ provider: 'sqlite', db: kysely }),
);

const engine = createReAuthEngine({
  dbClient: {
    version: async () => await client.version(),
    orm: (version: any) => client.orm(version),
  },
  plugins: [
    // Email/password for user authentication
    emailPasswordPlugin({
      sessionTtlSeconds: 3600,
      enableRegistration: true,
    }),

    // Basic session management
    sessionPlugin({
      // Cleanup configuration
      cleanupIntervalMinutes: 30, // Cleanup every 30 minutes
    }),
  ],
  getUserData: async (subjectId, orm) => {
    const user = await orm.findFirst('subjects', {
      where: (b) => b('id', '=', subjectId),
    });
    return user ?? {};
  },
});
```

### With Custom Cleanup

```ts
sessionPlugin({
  // More frequent cleanup for high-traffic applications
  cleanupIntervalMinutes: 15, // Cleanup every 15 minutes
});
```

## Configuration

### SessionConfig

| Option                   | Type     | Default | Description                  |
| ------------------------ | -------- | ------- | ---------------------------- |
| `cleanupIntervalMinutes` | `number` | `30`    | Cleanup frequency in minutes |

**Note:** Most configuration options in the SessionConfig interface are currently not implemented. Only `cleanupIntervalMinutes` is actively used. The other options are placeholders for future development.

## Database Schema

The session plugin uses the standard ReAuth session tables. No additional database schema is required beyond the base ReAuth setup.

## Authentication Steps

### 1. Get Session

**Step name:** `get-session`  
**HTTP:** `GET /auth/get-session`  
**Auth:** Required

Retrieve detailed information about the current session.

**Input:**

```ts
{
  token: Token; // Current session token
}
```

**Output:**

```ts
{
  success: boolean;
  status: 'su' | 'ic' | 'nf' | 'aut';
  message: string;
  session?: {
    id: string;
    subject_id: string;
    device_id?: string;
    created_at: string;
    expires_at: string;
    last_used_at: string;
    rotation_count: number;
    is_active: boolean;
    metadata?: Record<string, any>;
    device?: {
      id: string;
      device_name?: string;
      device_type?: string;
      os_name?: string;
      browser_name?: string;
      is_trusted: boolean;
    };
    location?: {
      country?: string;
      city?: string;
      region?: string;
    };
  };
  error?: string | object;
}
```

**Example:**

```ts
const result = await engine.executeStep('session', 'get-session', {
  token: userToken,
});

if (result.success) {
  console.log('Session ID:', result.session.id);
  console.log('Device:', result.session.device?.device_name);
  console.log('Location:', result.session.location?.city);
  console.log('Expires:', result.session.expires_at);
}
```

### 2. List Sessions

**Step name:** `list-sessions`  
**HTTP:** `GET /auth/list-sessions`  
**Auth:** Required

List all active sessions for the authenticated user.

**Input:**

```ts
{
  token: Token; // Current session token
  includeInactive?: boolean; // Include expired sessions
  limit?: number; // Max sessions to return
}
```

**Output:**

```ts
{
  success: boolean;
  status: 'su' | 'aut';
  sessions: Array<{
    id: string;
    device_id?: string;
    created_at: string;
    expires_at: string;
    last_used_at: string;
    is_active: boolean;
    is_current: boolean; // Is this the current session?
    device?: {
      device_name?: string;
      device_type?: string;
      os_name?: string;
      browser_name?: string;
      is_trusted: boolean;
    };
    location?: {
      country?: string;
      city?: string;
    };
  }>;
  total: number;
}
```

**Example:**

```ts
const result = await engine.executeStep('session', 'list-sessions', {
  token: userToken,
  limit: 10,
});

if (result.success) {
  result.sessions.forEach((session) => {
    console.log(`${session.is_current ? 'Current' : 'Other'} session:`);
    console.log(`  Device: ${session.device?.device_name || 'Unknown'}`);
    console.log(`  Location: ${session.location?.city || 'Unknown'}`);
    console.log(`  Last used: ${session.last_used_at}`);
    console.log(`  Expires: ${session.expires_at}`);
  });
}
```

### 3. Logout

**Step name:** `logout`  
**HTTP:** `POST /auth/logout`  
**Auth:** Required

Logout from the current session.

**Input:**

```ts
{
  token: Token; // Current session token
}
```

**Output:**

```ts
{
  success: boolean;
  status: 'su' | 'ic' | 'nf' | 'aut';
  message: string;
  error?: string | object;
}
```

**Example:**

```ts
const result = await engine.executeStep('session', 'logout', {
  token: userToken,
});

if (result.success) {
  console.log('Logged out successfully');
  // Remove token from client storage
  localStorage.removeItem('authToken');
}
```

### 4. Logout All Sessions

**Step name:** `logout-all`  
**HTTP:** `POST /auth/logout-all`  
**Auth:** Required

Logout from all sessions for the authenticated user.

**Input:**

```ts
{
  token: Token; // Current session token
}
```

**Output:**

```ts
{
  success: boolean;
  status: 'su' | 'aut';
  message: string;
  sessionsLoggedOut: number;
  error?: string | object;
}
```

**Example:**

```ts
const result = await engine.executeStep('session', 'logout-all', {
  token: userToken,
});

if (result.success) {
  console.log(`Logged out from ${result.sessionsLoggedOut} sessions`);
  // Remove token from client storage
  localStorage.removeItem('authToken');
}
```

## Background Cleanup

The plugin registers a basic cleanup task:

```ts
engine.registerCleanupTask({
  name: 'enhanced-sessions-cleanup',
  pluginName: 'session',
  intervalMs: 30 * 60 * 1000, // Every 30 minutes
  enabled: true,
  runner: async (orm, config) => {
    // Note: Currently returns placeholder data
    // TODO: Implement actual cleanup logic
    return {
      cleaned: 0,
      sessionsDeleted: 0,
      devicesDeleted: 0,
      metadataDeleted: 0,
    };
  },
});
```

## Profile API

The plugin exposes basic session information in user profiles:

```ts
const profile = await engine.getUnifiedProfile('user-123');

// profile.plugins['session']
{
  sessions: [
    {
      sessionId: 'session-1',
      token: 'abc12345...', // Truncated for security
      createdAt: '2025-01-15T10:30:00Z',
      expiresAt: '2025-01-15T11:30:00Z',
      deviceInfo: undefined, // Not implemented
      metadata: undefined, // Not implemented
    },
    // ... other sessions
  ],
  totalSessions: 3
}
```

## HTTP Adapter Integration

When using HTTP adapters, session steps are automatically exposed:

```ts
GET  /auth/get-session        → session:get-session (auth)
GET  /auth/list-sessions      → session:list-sessions (auth)
POST /auth/logout             → session:logout (auth)
POST /auth/logout-all         → session:logout-all (auth)
```

## Security Features

**Note:** Advanced security features like concurrent session limits, device tracking, and geolocation monitoring are not currently implemented in the session plugin. These features are placeholders for future development.

## Complete Example: Basic Session Management

```ts
// 1. User logs in and gets session
const loginResult = await engine.executeStep('email-password', 'login', {
  email: 'user@example.com',
  password: 'password123',
});

const sessionToken = loginResult.token;

// 2. User views their active sessions
const sessionsResult = await engine.executeStep('session', 'list-sessions', {
  token: sessionToken,
});

console.log(`Active sessions: ${sessionsResult.totalSessions}`);
sessionsResult.sessions.forEach((session) => {
  console.log(
    `Session ${session.sessionId}: ${session.isCurrent ? 'Current' : 'Other'}`,
  );
  console.log(`Created: ${session.createdAt}`);
});

// 3. User logs out from current session
const logoutResult = await engine.executeStep('session', 'logout', {
  token: sessionToken,
});

if (logoutResult.success) {
  console.log('Logged out successfully');
  localStorage.removeItem('authToken');
}

// 4. User logs out from all sessions (security measure)
const logoutAllResult = await engine.executeStep('session', 'logout-all', {
  token: sessionToken,
});

if (logoutAllResult.success) {
  console.log(`Logged out from ${logoutAllResult.sessionsDestroyed} sessions`);
}
```

## Use Cases

### Basic Session Management

```ts
// Simple session management for most applications
sessionPlugin({
  cleanupIntervalMinutes: 30, // Clean up every 30 minutes
});
```

### High-Traffic Application

```ts
// More frequent cleanup for high-traffic applications
sessionPlugin({
  cleanupIntervalMinutes: 15, // Clean up every 15 minutes
});
```

## Next Steps

<Cards>
  <Card
    href="/docs/engine/plugins/admin"
    title="Admin Plugin"
    description="Manage sessions through admin interface."
  />
  <Card
    href="/docs/engine/plugins/jwt"
    title="JWT Plugin"
    description="Use JWT tokens for stateless authentication."
  />
  <Card
    href="/docs/engine/configuration"
    title="Engine Configuration"
    description="Configure session TTLs and cleanup intervals."
  />
</Cards>
